<toolkit:Popup
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    xmlns:local="clr-namespace:BookInventoryApp.Behavior"
    x:Class="BookInventoryApp.BookPopupAndroid"
    Size="{OnIdiom Phone='380,680', Tablet='400,650', Desktop='640,720'}" Color="Transparent">
    <Border Stroke="#1da6ca" 
            StrokeThickness="2" 
            StrokeShape="RoundRectangle 20" 
            BackgroundColor="#0b121d"          
            WidthRequest="380" 
            HeightRequest="680">
        <ScrollView VerticalScrollBarVisibility="Never">

            <VerticalStackLayout  WidthRequest="380" HeightRequest="680" BackgroundColor="Black" Shadow="0 0 12 #1da6ca 1">

                <Label Shadow="0 0 12 #1da6ca 1" Text="📚 Book Details" FontSize="Title" TextColor="#1da6ca" FontAttributes="Bold" HorizontalOptions="Center" Margin="0,0,10,10"></Label>

                <VerticalStackLayout x:Name="Step1" IsVisible="True">

                    <VerticalStackLayout>
                        <Label Text="Title" TextColor="#B0BEC5">
                        </Label>

                        <Border>
                            <Border.StrokeShape>
                                <RoundRectangle/>
                            </Border.StrokeShape>
                            <Entry x:Name="TitleEntry" 
                                   Placeholder="Book title" 
                                   BackgroundColor="Transparent"
                                   FontSize="18"
                                   HorizontalOptions="FillAndExpand"
                                   VerticalOptions="CenterAndExpand" TextChanged="TitleEntry_TextChanged"/>
                        </Border>

                    </VerticalStackLayout>
                    <VerticalStackLayout>
                        <Label Text="Description" TextColor="#B0BEC5">
                        </Label>

                        <Border>
                            <Border.StrokeShape>
                                <RoundRectangle/>
                            </Border.StrokeShape>
                            <Entry x:Name="DescriptionEntry" 
                                   Placeholder="Description" 
                                   BackgroundColor="Transparent"
                                   FontSize="18"
                                   HorizontalOptions="FillAndExpand"
                                   VerticalOptions="CenterAndExpand"/>  
                        </Border>

                    </VerticalStackLayout>

                    <VerticalStackLayout>
                        <Label Text="Address" TextColor="#B0BEC5">
                        </Label>

                        <Border>
                            <Border.StrokeShape>
                                <RoundRectangle/>
                            </Border.StrokeShape>
                            <Entry x:Name="AdressEntry" 
                                   Placeholder="Address" 
                                   BackgroundColor="Transparent"
                                   FontSize="18"
                                   HorizontalOptions="FillAndExpand"
                                   VerticalOptions="CenterAndExpand"/> 
                        </Border>

                    </VerticalStackLayout>


                    <VerticalStackLayout>
                        <Label Text="Type" TextColor="#B0BEC5" HorizontalOptions="FillAndExpand"/>

                        <Border>
                            <Border.StrokeShape>
                                <RoundRectangle/>
                            </Border.StrokeShape>
                            <Picker x:Name="TypeEntry"
                                    Title="Select book type..."
                                    BackgroundColor="Transparent"
                                    FontSize="18"
                                    HorizontalOptions="FillAndExpand"
                                    VerticalOptions="CenterAndExpand" />
                        </Border>
                    </VerticalStackLayout>


                    <VerticalStackLayout>
                        <Label Text="Status" TextColor="#B0BEC5" />
                        <Border>
                            <Border.StrokeShape>
                                <RoundRectangle/>
                            </Border.StrokeShape>
                            <Picker  x:Name="StatusEntry"  
                                     Title="Select status..."
                                     BackgroundColor="Transparent"
                                     FontSize="18"
                                     HorizontalOptions="FillAndExpand"
                                     VerticalOptions="CenterAndExpand"/>
                        </Border>
                    </VerticalStackLayout>

                    <VerticalStackLayout>
                        <HorizontalStackLayout>
                            <Label Text="Number of Copies" TextColor="#B0BEC5" ></Label>
                            <Border>
                                <Border.StrokeShape>
                                    <RoundRectangle/>
                                </Border.StrokeShape>
                                <Entry x:Name="NrOfCopiesEntry"
                                       TextChanged="Entry_TextChanged" 
                                       MaximumWidthRequest="50" 
                                       Background="Transparent"
                                       TextColor="White">
                                    <Entry.Behaviors>
                                        <local:PositiveNumberBehavior />
                                    </Entry.Behaviors>
                                </Entry>

                            </Border>

                            <Label Text="Is Read?" TextColor="#B0BEC5" ></Label>
                            <Border>
                                <Border.StrokeShape>
                                    <RoundRectangle/>
                                </Border.StrokeShape>
                                <Switch x:Name="IsReadSwitch"
                                        MaximumWidthRequest="50" 
                                        Background="Transparent">
                                    <Switch.Behaviors>
                                        <local:PositiveNumberBehavior />
                                    </Switch.Behaviors>
                                </Switch>
                            </Border>
                        </HorizontalStackLayout>
                    </VerticalStackLayout>
                </VerticalStackLayout>
                <VerticalStackLayout x:Name="Step2" IsVisible="False">
                    <HorizontalStackLayout>
                        <VerticalStackLayout  HorizontalOptions="Center">
                            <Border>
                                <Border.StrokeShape>
                                    <RoundRectangle/>
                                </Border.StrokeShape>
                                <SearchBar x:Name="AuthorsSearch"
                                           Placeholder="Search authors..."
                                           TextChanged="OnSearchTextChanged"
                                           BackgroundColor="Transparent"
                                           TextColor="White"
                                           PlaceholderColor="LightGray"
                                           FontFamily="VictorMono-Regular" 
                                           HeightRequest="45" 
                                           HorizontalOptions="Center"
                                           WidthRequest="{OnIdiom Phone=250, Tablet=350, Desktop=250}"
                                           Margin="0,10,10,10"/> 
                            </Border>
                            <ListView x:Name="FilteredAuthorsView"
                                      IsVisible="True"
                                      ItemSelected="Authors_ItemSelected"
                                      BackgroundColor="#DCD3FF"
                                      HeightRequest="100" 
                                      HorizontalOptions="FillAndExpand"
                                      WidthRequest="{OnIdiom Phone=250, Tablet=300, Desktop=250}"
                                      Margin="5,10,10,10"/>
                            <CollectionView x:Name="SelectedAuthorsView"
                                            ItemsLayout="VerticalList"
                                            BackgroundColor="Transparent"
                                            HorizontalOptions="Start"
                                            VerticalOptions="Center"
                                            Margin="0,10,0,0"/> 

                        </VerticalStackLayout>
                    </HorizontalStackLayout>
                </VerticalStackLayout>
                <VerticalStackLayout x:Name="Step3" IsVisible="False">
                    <HorizontalStackLayout>
                        <VerticalStackLayout  HorizontalOptions="Center">
                            <Border>
                                <Border.StrokeShape>
                                    <RoundRectangle/>
                                </Border.StrokeShape>
                                <SearchBar x:Name="LanguagesSearch"
                                           Placeholder="Search languages..."
                                           TextChanged="OnLanguagesSearchTextChanged"
                                           BackgroundColor="Black"
                                           TextColor="White"
                                           PlaceholderColor="LightGray"
                                           FontFamily="VictorMono-Regular"
                                           HeightRequest="45" 
                                           HorizontalOptions="FillAndExpand"
                                           WidthRequest="{OnIdiom Phone=250, Tablet=300, Desktop=250}"
                                           Margin="5,10,10,10"/>
                            </Border>
                            <ListView x:Name="FilteredLanguagesView"
                                      IsVisible="True"
                                      ItemSelected="Languages_ItemSelected"
                                      BackgroundColor="#DCD3FF"
                                      HeightRequest="100"
                                      HorizontalOptions="Start"
                                      WidthRequest="{OnIdiom Phone=250, Tablet=300, Desktop=250}"
                                      Margin="0"/>
                            <CollectionView x:Name="SelectedLanguagesView"
                                            ItemsLayout="VerticalList"
                                            BackgroundColor="Transparent"
                                            HorizontalOptions="Start"
                                            VerticalOptions="Center"
                                            Margin="0,10,0,0"/>
                        </VerticalStackLayout>
                    </HorizontalStackLayout>
                </VerticalStackLayout>
                <VerticalStackLayout x:Name="Step4" IsVisible="False">
                    <HorizontalStackLayout>
                        <VerticalStackLayout  HorizontalOptions="Center">
                            <Border>
                                <Border.StrokeShape>
                                    <RoundRectangle/>
                                </Border.StrokeShape>
                                <SearchBar x:Name="CategoriesSearch"
                                           Placeholder="Search categories..."
                                           TextChanged="OnCategoriesSearchTextChanged"
                                           BackgroundColor="Transparent"
                                           TextColor="White"
                                           PlaceholderColor="LightGray"
                                           FontFamily="VictorMono-Regular"
                                           HeightRequest="45" 
                                           HorizontalOptions="FillAndExpand"
                                           WidthRequest="{OnIdiom Phone=250, Tablet=300, Desktop=250}"
                                           Margin="5,10,10,10"/>
                            </Border>
                            <ListView x:Name="FilteredCategoriesView"
                                      IsVisible="True"
                                      ItemSelected="Categories_ItemSelected"
                                      BackgroundColor="Transparent"
                                      HeightRequest="100"
                                      SeparatorVisibility="None" 
                                      HorizontalOptions="FillAndExpand"
                                      WidthRequest="{OnIdiom Phone=250, Tablet=300, Desktop=250}"
                                      Margin="5,10,10,10"/>
                            <CollectionView x:Name="SelectedCategoriesView"
                                            ItemsLayout="VerticalList"
                                            BackgroundColor="Transparent"
                                            HorizontalOptions="Start"
                                            VerticalOptions="Center"
                                            Margin="0,10,0,0"/>
                        </VerticalStackLayout>
                    </HorizontalStackLayout>
                </VerticalStackLayout>

                <VerticalStackLayout x:Name="Step5" IsVisible="False">
                    <HorizontalStackLayout>
                        <VerticalStackLayout Padding="20" Spacing="20" HorizontalOptions="Center" IsVisible="True">
                            <Button Text="Upload Image" Clicked="OnUploadImageClicked" />
                            <Image x:Name="UploadedImage" HeightRequest="200" />
                        </VerticalStackLayout>
                    </HorizontalStackLayout>
                </VerticalStackLayout>
                <!-- Navigation Buttons -->
                <HorizontalStackLayout HorizontalOptions="Center" VerticalOptions="CenterAndExpand">
                    <Button x:Name="BackButton" Text="Back" Clicked="OnBackClicked" IsVisible="False" Margin="15"/>
                    <Button x:Name="NextButton" 
                            Text="Next" 
                            IsEnabled="False"
                            Clicked="OnNextClicked" 
                            BorderColor="#1da6ca" 
                            BackgroundColor="Transparent"
                            FontAttributes="Bold"
                            Padding="5"
                            Margin="10"
                            Shadow="0 0 12 #1da6ca 1"
                            HeightRequest="40" 
                            WidthRequest="70"
                            TextColor="White" IsVisible="True"/>
                </HorizontalStackLayout>
                <Grid x:Name="SuccessOverlay"
                      BackgroundColor="#80000000"
                      IsVisible="False"
                      Opacity="0"
                      ZIndex="10"
                      HorizontalOptions="Fill"
                      VerticalOptions="Fill"
                      AbsoluteLayout.LayoutFlags="All"
                      AbsoluteLayout.LayoutBounds="0,0,1,1">
                    <Label Text="✅ Book added successfully!"
                           FontSize="18"
                           FontAttributes="Bold"
                           TextColor="White"
                           BackgroundColor="MediumSeaGreen"
                           Padding="15"
                           HorizontalOptions="Center"
                           VerticalOptions="Center"
                           Opacity="1"/>
                    <Grid x:Name="ErrorOverlay"
                          BackgroundColor="#80000000"
                          IsVisible="False"
                          Opacity="0"
                          ZIndex="10"
                          HorizontalOptions="Fill"
                          VerticalOptions="Fill"
                          AbsoluteLayout.LayoutFlags="All"
                          AbsoluteLayout.LayoutBounds="0,0,1,1">
                        <Label Text="❌ Failed to add book!"
                               FontSize="18"
                               FontAttributes="Bold"
                               TextColor="White"
                               BackgroundColor="DarkRed"
                               Padding="15"
                               HorizontalOptions="Center"
                               VerticalOptions="Center"
                               Opacity="1"/>
                    </Grid>
                </Grid>
            </VerticalStackLayout>
        </ScrollView>
    </Border>
</toolkit:Popup>
