<toolkit:Popup
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    xmlns:local="clr-namespace:BookInventoryApp.Behavior"
    x:Class="BookInventoryApp.BookPopupAndroid"
    Size="{OnIdiom Phone='380,680', Tablet='400,650', Desktop='640,720'}" Color="Transparent">
    <Border Stroke="#1da6ca" 
            StrokeThickness="2" 
            StrokeShape="RoundRectangle 20" 
            BackgroundColor="#0b121d"          
            WidthRequest="380" 
            HeightRequest="600">
        <ScrollView VerticalScrollBarVisibility="Never">

            <VerticalStackLayout  WidthRequest="380" HeightRequest="650" BackgroundColor="Black" Shadow="0 0 12 #1da6ca 1">

                <Label Shadow="0 0 12 #1da6ca 1" Text="📚 Book Details" FontSize="Title" TextColor="#1da6ca" FontAttributes="Bold" HorizontalOptions="Center" Margin="0,0,10,10"></Label>

                    <VerticalStackLayout x:Name="Step1" IsVisible="True">

                        <VerticalStackLayout>
                            <Label Text="Title" TextColor="#B0BEC5">
                            </Label>

                            <Border>
                                <Border.StrokeShape>
                                    <RoundRectangle/>
                                </Border.StrokeShape>
                                <Entry x:Name="TitleEntry" 
                                       Placeholder="Book title" 
                                       BackgroundColor="Transparent"
                                       FontSize="18"
                                       HorizontalOptions="FillAndExpand"
                                       VerticalOptions="CenterAndExpand"/>
                            </Border>

                        </VerticalStackLayout>

                        <VerticalStackLayout>
                            <Label Text="Type" TextColor="#B0BEC5" HorizontalOptions="FillAndExpand"/>

                            <Border>
                                <Border.StrokeShape>
                                    <RoundRectangle/>
                                </Border.StrokeShape>
                                <Picker x:Name="TypeEntry"
                                Title="Select book type..."
                                BackgroundColor="Transparent"
                                FontSize="18"
                                HorizontalOptions="FillAndExpand"
                                VerticalOptions="CenterAndExpand"/>
                            </Border>
                        </VerticalStackLayout>


                        <VerticalStackLayout>
                            <Label Text="Status" TextColor="#B0BEC5" />
                            <Border>
                                <Border.StrokeShape>
                                    <RoundRectangle/>
                                </Border.StrokeShape>
                                <Picker  x:Name="StatusEntry"  
                                Title="Select status..."
                                BackgroundColor="Transparent"
                                FontSize="18"
                                HorizontalOptions="FillAndExpand"
                                VerticalOptions="CenterAndExpand"/>
                            </Border>
                        </VerticalStackLayout>

                        <VerticalStackLayout>
                            <Label Text="Number of Copies" TextColor="#B0BEC5" ></Label>   
                        <Border> 
                            <Border.StrokeShape>
                                <RoundRectangle/>
                            </Border.StrokeShape>
                            <Entry 
                                   TextChanged="Entry_TextChanged" 
                                   MaximumWidthRequest="50" 
                                   Background="Transparent">
                                <Entry.Behaviors>
                                    <local:PositiveNumberBehavior />
                                </Entry.Behaviors>
                            </Entry>

                        </Border>
                        </VerticalStackLayout>
                    </VerticalStackLayout>

                    <VerticalStackLayout x:Name="Step2" IsVisible="False">
                        <HorizontalStackLayout>
                            <VerticalStackLayout  HorizontalOptions="Center">
                                <SearchBar x:Name="AuthorsSearch"
                               Placeholder="Search authors..."
                               TextChanged="OnSearchTextChanged"
                               BackgroundColor="Black"
                               TextColor="White"
                               PlaceholderColor="LightGray"
                               FontFamily="VictorMono-Regular" 
                               HeightRequest="45" 
                               HorizontalOptions="FillAndExpand"
                               WidthRequest="{OnIdiom Phone=50, Tablet=100, Desktop=250}"
                               Margin="0,10,10,10"/>

                                <AbsoluteLayout>
                                    <AbsoluteLayout>
                                        <SearchBar x:Name="LanguagesSearch"
                                       Placeholder="Search languages..."
                                       TextChanged="OnLanguagesSearchTextChanged"
                                       BackgroundColor="Black"
                                       TextColor="White"
                                       PlaceholderColor="LightGray"
                                       FontFamily="VictorMono-Regular"
                                       HeightRequest="45" 
                                       HorizontalOptions="FillAndExpand"
                                       WidthRequest="{OnIdiom Phone=50, Tablet=100, Desktop=250}"
                                       Margin="5,10,10,10"/>

                                        <ListView x:Name="FilteredAuthorsView"
                                      IsVisible="False"
                                      ItemSelected="Authors_ItemSelected"
                                      BackgroundColor="#DCD3FF"
                                      HeightRequest="100"
                                      SeparatorVisibility="None" 
                                      HorizontalOptions="FillAndExpand"
                                      WidthRequest="{OnIdiom Phone=50, Tablet=100, Desktop=250}"
                                      Margin="5,10,10,10"/>
                                    </AbsoluteLayout>


                                </AbsoluteLayout>

                            </VerticalStackLayout>

                            <VerticalStackLayout>
                                <SearchBar x:Name="CategoriesSearch"
                               Placeholder="Search categories..."
                               TextChanged="OnCategoriesSearchTextChanged"
                               BackgroundColor="Transparent"
                               TextColor="White"
                               PlaceholderColor="LightGray"
                               FontFamily="VictorMono-Regular"
                               HeightRequest="45" 
                               HorizontalOptions="FillAndExpand"
                               WidthRequest="{OnIdiom Phone=50, Tablet=100, Desktop=250}"
                               Margin="5,10,10,10"/>
                                <AbsoluteLayout>

                                    <ListView x:Name="FilteredCategoriesView"
                                  IsVisible="False"
                                  ItemSelected="Categories_ItemSelected"
                                  BackgroundColor="Transparent"
                                  RowHeight="50"
                                  HeightRequest="100"
                                  SeparatorVisibility="None" 
                                  HorizontalOptions="FillAndExpand"
                                  WidthRequest="{OnIdiom Phone=50, Tablet=100, Desktop=250}"
                                  Margin="5,10,10,10"/>
                                </AbsoluteLayout>
                            </VerticalStackLayout>

                        </HorizontalStackLayout>
                        <ListView x:Name="FilteredLanguagesView"
                      IsVisible="False"
                      ItemSelected="Languages_ItemSelected"
                      BackgroundColor="#DCD3FF"
                      RowHeight="50"
                      HeightRequest="100"
                      SeparatorVisibility="None" 
                      HorizontalOptions="Start"
                      WidthRequest="{OnIdiom Phone=50, Tablet=100, Desktop=250}"
                      Margin="0"/>

                        <VerticalStackLayout>
                            <HorizontalStackLayout HorizontalOptions="Center">
                                <VerticalStackLayout 
                                         HorizontalOptions="FillAndExpand">
                                    <Label x:Name="SelectedAuthorsViewName" 
                               Text="AUTHORS:" 
                               Margin="5,5,5,5" 
                               FontAttributes="Bold" 
                               HorizontalOptions="FillAndExpand"
                               BackgroundColor="#90CAF9" Padding="10,10,10,10"></Label>
                                    <CollectionView x:Name="SelectedAuthorsView"
                                        ItemsLayout="VerticalList"
                                        IsVisible="True"
                                        BackgroundColor="Transparent"
                                        MaximumWidthRequest="{OnIdiom Phone=50, Tablet=100, Desktop=150}"
                                        WidthRequest="{OnIdiom Phone=50, Tablet=100, Desktop=150}"
                                        Margin="5,5,5,5" />
                                </VerticalStackLayout>
                                <VerticalStackLayout 
                         
                                         Padding="0"
                                         HorizontalOptions="FillAndExpand"
>
                                    <Label x:Name="SelectedCategoriesViewName" 
                               Text="CATEGORIES:" 
                               Margin="5,5,5,5" 
                               FontAttributes="Bold"
                               HorizontalOptions="FillAndExpand"
                                BackgroundColor="#9370DB"
                               Padding="10,10,10,10"></Label>
                                    <CollectionView x:Name="SelectedCategoriesView"
                                        IsVisible="False"
                                        ItemsLayout="VerticalList"
                                        BackgroundColor="#9370DB"
                                        MaximumWidthRequest="{OnIdiom Phone=50, Tablet=100, Desktop=150}"
                                        WidthRequest="{OnIdiom Phone=50, Tablet=100, Desktop=150}"
                                        Margin="5,5,5,5"
                                        HorizontalOptions="FillAndExpand"/>
                                </VerticalStackLayout>

                                <VerticalStackLayout 
                               
                                         Padding="0"
                                         HorizontalOptions="FillAndExpand">
                                    <Label x:Name="SelectedLanguagesViewName" 
                               Text="LANGUAGES:" 
                               Margin="5,5,5,5" 
                               FontAttributes="Bold"
                               HorizontalOptions="FillAndExpand"
                               BackgroundColor="#9370DB"
                               Padding="10,10,10,10"></Label>
                                    <CollectionView x:Name="SelectedLanguagesView"
                                        IsVisible="False"
                                        ItemsLayout="VerticalList"
                                        BackgroundColor="#9370DB"
                                        MaximumWidthRequest="{OnIdiom Phone=50, Tablet=100, Desktop=150}"
                                        WidthRequest="{OnIdiom Phone=50, Tablet=100, Desktop=150}"
                                         Margin="5,5,5,5" 
                                        HorizontalOptions="FillAndExpand"/>
                                </VerticalStackLayout>

                            </HorizontalStackLayout>
                        </VerticalStackLayout>
                    </VerticalStackLayout>

                    <VerticalStackLayout x:Name="Step3" IsVisible="False">
                        <Button Text="Save"
                                Clicked="OnSaveClicked"
                                TextColor="White"
                                BackgroundColor="MediumPurple"
                                FontAttributes="Bold"
                                CornerRadius="10"
                                FontFamily="VictorMono-Bold"
                                HorizontalOptions="Center"
                                WidthRequest="140"
                                HeightRequest="45" IsVisible="True" />   
                        <Label Text="Ready to save your book?" FontAttributes="Bold" FontSize="18" HorizontalOptions="Center"/>
                    </VerticalStackLayout>
                
                <!-- Navigation Buttons -->
                <HorizontalStackLayout HorizontalOptions="Center" VerticalOptions="CenterAndExpand">
                    <Button x:Name="BackButton" Text="Back" Clicked="OnBackClicked" IsVisible="False"/>
                    <Button x:Name="NextButton" 
                        Text="Next" 
                        Clicked="OnNextClicked" 
                        BorderColor="#1da6ca" 
                        BackgroundColor="Transparent"
                        FontAttributes="Bold"
                        Padding="5"
                        Shadow="0 0 12 #1da6ca 1"
                        HeightRequest="40" 
                        WidthRequest="70"
                        TextColor="White" IsVisible="True"/>
                </HorizontalStackLayout>
                <Grid x:Name="SuccessOverlay"
                          BackgroundColor="#80000000"
                          IsVisible="False"
                          Opacity="0"
                          ZIndex="10"
                          HorizontalOptions="Fill"
                          VerticalOptions="Fill"
                          AbsoluteLayout.LayoutFlags="All"
                          AbsoluteLayout.LayoutBounds="0,0,1,1">
                    <Label Text="✅ Book added successfully!"
                               FontSize="18"
                               FontAttributes="Bold"
                               TextColor="White"
                               BackgroundColor="MediumSeaGreen"
                               Padding="15"
                               HorizontalOptions="Center"
                               VerticalOptions="Center"
                               Opacity="1"/>
                    <Grid x:Name="ErrorOverlay"
                              BackgroundColor="#80000000"
                              IsVisible="False"
                              Opacity="0"
                              ZIndex="10"
                              HorizontalOptions="Fill"
                              VerticalOptions="Fill"
                              AbsoluteLayout.LayoutFlags="All"
                              AbsoluteLayout.LayoutBounds="0,0,1,1">
                        <Label Text="❌ Failed to add book!"
                               FontSize="18"
                               FontAttributes="Bold"
                               TextColor="White"
                               BackgroundColor="DarkRed"
                               Padding="15"
                               HorizontalOptions="Center"
                               VerticalOptions="Center"
                               Opacity="1"/>
                    </Grid>
                </Grid>
            </VerticalStackLayout>
        </ScrollView>
    </Border>
</toolkit:Popup>
