<toolkit:Popup xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
               xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
               xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
               x:Class="BookInventoryApp.LendBorrowPopup"
               Size="300,400">

    <Grid RowDefinitions="Auto,Auto,*,Auto,Auto"
          RowSpacing="15" x:Name="MainLayout">

        <!-- Title -->
        <Label x:Name="PopupTitle"
               Grid.Row="0"
               Text="Borrow / Lend Book"
               FontSize="20"
               HorizontalOptions="Center"
               FontAttributes="Bold"
               Margin="0,10,0,10" />

        <HorizontalStackLayout  Grid.Row="1" HorizontalOptions="Start"  Margin="10,0,0,0" Padding="20">
            <VerticalStackLayout>
                <!-- DatePicker -->
                <Label Text="Start " 
                   TextColor="Black" 
                   FontAttributes="Bold" 
                 >
                </Label>
                <DatePicker x:Name="BorrowDate"
                    />
            </VerticalStackLayout>
            <VerticalStackLayout >
                <!-- DatePicker -->
                <Label Text="Return " 
                   TextColor="Black" 
                   FontAttributes="Bold" 
                 >
                </Label>
                <DatePicker x:Name="ReturnDate"
                    />
            </VerticalStackLayout>
        </HorizontalStackLayout>
        <VerticalStackLayout Grid.Row="2">
            <Label x:Name="SelectedBooksViewName" 
                            Text="Selected:" 
                            Margin="5,5,5,5" 
                            FontAttributes="Bold" 
                            HorizontalOptions="Fill"
                            BackgroundColor="Transparent"
                            TextColor="GhostWhite"
                            Opacity="0.8"
                            Padding="10,10,10,10"></Label>
            <CollectionView x:Name="SelectedBooksView"
                                     ItemsLayout="HorizontalList"
                                     IsVisible="True"                         
                                     MaximumWidthRequest="{OnIdiom Phone=300, Tablet=300}"
                                     WidthRequest="300"
                                     BackgroundColor="Transparent" />
        </VerticalStackLayout>


        <VerticalStackLayout Margin="20,20,20,10"  Grid.Row="3" IsVisible="True">
            <!-- SearchBar -->
            <SearchBar x:Name="BookSearchBar"
                   Placeholder="Search or enter book title"
                   TextChanged="OnBookSearchChanged"
                   BackgroundColor="#f2f2f2"
                   Margin="0" />

            <!-- Suggestions -->
            <ListView x:Name="BookSuggestions"
                        SelectionMode="Single"
                        IsVisible="False"
                        ItemSelected="OnSuggestionSelected">
            </ListView>

        </VerticalStackLayout>
  
        <!-- Save Button -->
        <Button x:Name="SaveButton"
                Grid.Row="4"
                Text="Save"
                Clicked="OnBorrowConfirm"
                BackgroundColor="MediumPurple"
                TextColor="White"
                CornerRadius="8"
                HorizontalOptions="Center"
                Margin="0,10,0,20" />
        <!-- Success Overlay -->
        <Grid x:Name="SuccessOverlay"
         BackgroundColor="#80000000"
         IsVisible="False"
         Opacity="0"
         ZIndex="99"
         HorizontalOptions="Fill"
         VerticalOptions="Fill"
         RowSpan="3">

            <Label x:Name="SuccessIcon"
              Text="✅"
              FontSize="64"
              HorizontalOptions="Center"
              VerticalOptions="Center"/>
        </Grid>

        <!-- Error Overlay -->
        <Grid x:Name="ErrorOverlay"
         BackgroundColor="#80000000"
         IsVisible="False"
         Opacity="0"
         ZIndex="99"
         HorizontalOptions="Fill"
         VerticalOptions="Fill"
         RowSpan="3">

            <StackLayout VerticalOptions="Center"
                    HorizontalOptions="Center"
                    Spacing="10">
                <Label x:Name="ErrorIcon"
                  Text="❌"
                  FontSize="30"
                  TextColor="White"
                  HorizontalOptions="Center"/>
                <Label x:Name="ErrorMessage"
                  Text="Something went wrong!"
                  FontSize="18"
                  TextColor="White"
                  HorizontalOptions="Center"/>
            </StackLayout>
        </Grid>
    </Grid>
</toolkit:Popup>
