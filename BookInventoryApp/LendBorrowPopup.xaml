<toolkit:Popup xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
               xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
               xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
               x:Class="BookInventoryApp.LendBorrowPopup"
               CanBeDismissedByTappingOutsideOfPopup="True"
               Color="#80000000"
               Size="320,500">

    <Frame BackgroundColor="White" CornerRadius="12" Padding="20" HasShadow="True">
        <Grid RowDefinitions="Auto,Auto,Auto,*,Auto,Auto" RowSpacing="15">

            <!-- Title -->
            <Label x:Name="PopupTitle"
                   Grid.Row="0"
                   Text="Borrow / Lend Book"
                   FontSize="20"
                   FontAttributes="Bold"
                   HorizontalOptions="Center"
                   TextColor="Black"
                   Margin="0,0,0,10" />

            <!-- Dates -->
            <Grid Grid.Row="1" ColumnSpacing="20">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <VerticalStackLayout Grid.Column="0">
                    <Label Text="Start"
                           TextColor="Black"
                           FontAttributes="Bold" />
                    <DatePicker x:Name="BorrowDate" />
                </VerticalStackLayout>

                <VerticalStackLayout Grid.Column="1">
                    <Label Text="Return"
                           TextColor="Black"
                           FontAttributes="Bold" />
                    <DatePicker x:Name="ReturnDate" />
                </VerticalStackLayout>
            </Grid>

            <!-- Selected Books -->
            <VerticalStackLayout Grid.Row="2" Spacing="5">
                <Label Text="Selected Books:"
                       FontAttributes="Bold"
                       TextColor="Black"
                       Margin="0,5,0,5"/>
                <CollectionView x:Name="SelectedBooksView"
                                ItemsLayout="HorizontalList"
                                HeightRequest="80"
                                BackgroundColor="#f9f9f9"
                                Margin="0"
                                />
            </VerticalStackLayout>

            <!-- Search and Suggestions -->
            <VerticalStackLayout Grid.Row="3" Spacing="10">
                <SearchBar x:Name="BookSearchBar"
                           Placeholder="Search or enter book title"
                           TextChanged="OnBookSearchChanged"
                           BackgroundColor="#f2f2f2" />
                <ListView x:Name="BookSuggestions"
                          IsVisible="False"
                          SelectionMode="Single"
                          ItemSelected="OnSuggestionSelected"
                          HeightRequest="120"
                          BackgroundColor="#f2f2f2" />
            </VerticalStackLayout>

            <!-- Save Button -->
            <Button x:Name="SaveButton"
                    Grid.Row="4"
                    Text="Save"
                    Clicked="OnBorrowConfirm"
                    BackgroundColor="MediumPurple"
                    TextColor="White"
                    CornerRadius="8"
                    Margin="0,10,0,0"
                    HorizontalOptions="Center"
                    WidthRequest="150" />

            <!-- Overlay: Success -->
            <Grid x:Name="SuccessOverlay"
                  Grid.RowSpan="6"
                  BackgroundColor="#80000000"
                  IsVisible="False"
                  Opacity="0"
                  ZIndex="99">
                <Label Text="✅"
                       FontSize="64"
                       HorizontalOptions="Center"
                       VerticalOptions="Center" />
            </Grid>

            <!-- Overlay: Error -->
            <Grid x:Name="ErrorOverlay"
                  Grid.RowSpan="6"
                  BackgroundColor="#80000000"
                  IsVisible="False"
                  Opacity="0"
                  ZIndex="99">
                <StackLayout VerticalOptions="Center"
                             HorizontalOptions="Center"
                             Spacing="10">
                    <Label Text="❌"
                           FontSize="30"
                           TextColor="White"
                           HorizontalOptions="Center" />
                    <Label x:Name="ErrorMessage"
                           Text="Something went wrong!"
                           FontSize="18"
                           TextColor="White"
                           HorizontalOptions="Center" />
                </StackLayout>
            </Grid>

        </Grid>
    </Frame>
</toolkit:Popup>
