<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             x:Class="BookInventoryApp.FriendsPage"
             Title="Friends"
             BackgroundColor="#121212">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="20">

            <!-- Search -->
            <SearchBar x:Name="SearchBar"
                       Placeholder="Search friends..."
                       TextChanged="OnSearchTextChanged"
                       BackgroundColor="#1e1e1e"
                       TextColor="White"
                       PlaceholderColor="#888"
                       CancelButtonColor="White"
                       Margin="0,0,0,10" />

            <!-- Add Friend Button -->
            <Button Text="Add New Friend"
                    Clicked="OnAddFriendClicked"
                    BackgroundColor="#1da6ca"
                    TextColor="White"
                    CornerRadius="12"
                    FontAttributes="Bold"
                    HorizontalOptions="End"
                    WidthRequest="180" />

            <!-- Friends List -->
            <CollectionView x:Name="FriendCollection"
                            Margin="0,10"
                            ItemsLayout="VerticalList"
                            SelectionMode="None">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <SwipeView>
                            <!-- Left Swipe: Delete -->
                            <SwipeView.LeftItems>
                                <SwipeItems>
                                    <SwipeItem Text="Delete"
                                               IconImageSource="delete.png"
                                               Invoked="SwipeItem_Invoked"
                                               CommandParameter="{Binding .}"
                                               BackgroundColor="#b00020" />
                                </SwipeItems>
                            </SwipeView.LeftItems>

                            <!-- Right Swipe: Lend / Borrow / View -->
                            <SwipeView.RightItems>
                                <SwipeItems>
                                    <SwipeItem Text="Lend"
                                               BackgroundColor="#4CAF50"
                                               Clicked="OnLendBookClicked"
                                               CommandParameter="{Binding .}" />
                                    <SwipeItem Text="Borrow"
                                               BackgroundColor="#2196F3"
                                               Invoked="OnBorrowBookClicked"
                                               CommandParameter="{Binding .}" />
                                    <SwipeItem Text="Loans"
                                               BackgroundColor="#FF9800"
                                               Invoked="OnViewLoansClicked"
                                               CommandParameter="{Binding .}" />
                                </SwipeItems>
                            </SwipeView.RightItems>

                            <!-- Friend Card -->
                            <Frame CornerRadius="12"
                                   Padding="15"
                                   Margin="0,5"
                                   BackgroundColor="#2a2a2a"
                                   HasShadow="True"
                                   BorderColor="#444">
                                <Grid ColumnDefinitions="*,Auto">
                                    <!-- Left Side: Info -->
                                    <VerticalStackLayout Grid.Column="0"
                                                         Spacing="8">
                                        <VerticalStackLayout.GestureRecognizers>
                                            <TapGestureRecognizer Tapped="OnFriendTapped"
                                                                  CommandParameter="{Binding .}" />
                                        </VerticalStackLayout.GestureRecognizers>

                                        <Label Text="{Binding FullName}"
                                               FontSize="16"
                                               FontAttributes="Bold"
                                               TextColor="White" />
                                        <Label FontSize="14" TextColor="#cccccc">
                                            <Label.FormattedText>
                                                <FormattedString>
                                                    <Span Text="Nickname: " FontAttributes="Italic" />
                                                    <Span Text="{Binding Nickname}" />
                                                </FormattedString>
                                            </Label.FormattedText>
                                        </Label>

                                        <Label FontSize="14" TextColor="#cccccc">
                                            <Label.FormattedText>
                                                <FormattedString>
                                                    <Span Text="Address: " FontAttributes="Italic" />
                                                    <Span Text="{Binding Address}" />
                                                </FormattedString>
                                            </Label.FormattedText>
                                        </Label>
                                    </VerticalStackLayout>

                                    <!-- Right Side: Profile Picture -->
                                    <Frame Grid.Column="1"
                                           CornerRadius="30"
                                           Padding="0"
                                           WidthRequest="60"
                                           HeightRequest="60"
                                           HasShadow="False"
                                           BackgroundColor="Transparent"
                                           BorderColor="#888">
                                        <Image Source="no_img.jpg"
                                               WidthRequest="60"
                                               HeightRequest="60"
                                               Aspect="AspectFill"
                                               Clip="True" />
                                    </Frame>
                                </Grid>
                            </Frame>
                        </SwipeView>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
